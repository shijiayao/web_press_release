(self["webpackChunkfront_end"]=self["webpackChunkfront_end"]||[]).push([[927],{5380:function(e){e.exports={formatTargetDate(e){let t=new Date(e);return{YY:"".concat("0000",t.getFullYear()).slice(-4),MM:"".concat("0000",t.getMonth()+1).slice(-2),DD:"".concat("0000",t.getDate()).slice(-2),HH:"".concat("0000",t.getHours()).slice(-2),mm:"".concat("0000",t.getMinutes()).slice(-2),ss:"".concat("0000",t.getSeconds()).slice(-2),SSS:"".concat("0000",t.getMilliseconds()).slice(-3)}},formatCurrentDate(){let e=new Date;return{YY:"".concat("0000",e.getFullYear()).slice(-4),MM:"".concat("0000",e.getMonth()+1).slice(-2),DD:"".concat("0000",e.getDate()).slice(-2),HH:"".concat("0000",e.getHours()).slice(-2),mm:"".concat("0000",e.getMinutes()).slice(-2),ss:"".concat("0000",e.getSeconds()).slice(-2),SSS:"".concat("0000",e.getMilliseconds()).slice(-3)}}}},2927:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var l=a(3396),o=a(7139);const i=e=>((0,l.dD)("data-v-51a328ba"),e=e(),(0,l.Cn)(),e),n={class:"news-manage-wrap"},r={class:"head-box"},s=i((()=>(0,l._)("p",{class:"label-text"},"新闻分类",-1))),d=(0,l.Uk)("搜索"),c=(0,l.Uk)("重置搜索条件"),u=(0,l.Uk)("新增新闻"),p={class:"table-box"},m=["title"],w={class:"single-line-show"},g=(0,l.Uk)("编辑"),b=(0,l.Uk)("删除"),h=["src"],D=i((()=>(0,l._)("p",{class:"info"},"缩略图是可选的",-1))),f=i((()=>(0,l._)("section",{class:"editor-toolbar"},[(0,l._)("button",{class:"ql-upload"},"upload")],-1))),y=i((()=>(0,l._)("section",{class:"editor-content"},null,-1))),_={class:"dialog-footer"},k=(0,l.Uk)("取消"),V=(0,l.Uk)("新增"),z=(0,l.Uk)("修改"),C={class:"title"},W={class:"detail-wrap"},U=["innerHTML"],T={class:"dialog-footer"},R=(0,l.Uk)("关闭");function M(e,t,a,i,M,v){const B=(0,l.up)("el-input"),$=(0,l.up)("el-option"),H=(0,l.up)("el-select"),S=(0,l.up)("el-button"),x=(0,l.up)("el-table-column"),Y=(0,l.up)("el-popconfirm"),F=(0,l.up)("el-table"),G=(0,l.up)("el-form-item"),j=(0,l.up)("Plus"),I=(0,l.up)("el-icon"),L=(0,l.up)("el-upload"),N=(0,l.up)("el-form"),A=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.iD)("section",n,[(0,l._)("section",r,[(0,l.Wm)(B,{modelValue:M.headForm.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>M.headForm.keyword=e),placeholder:"标题或者内容中包含的关键词",clearable:""},null,8,["modelValue"]),s,(0,l.Wm)(H,{modelValue:M.headForm.type,"onUpdate:modelValue":t[1]||(t[1]=e=>M.headForm.type=e)},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(v.headNewsTypeGroup,(e=>((0,l.wg)(),(0,l.j4)($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,l.Wm)(S,{type:"primary",onClick:v.headSearchButton},{default:(0,l.w5)((()=>[d])),_:1},8,["onClick"]),(0,l.Wm)(S,{type:"warning",onClick:v.headResetButton},{default:(0,l.w5)((()=>[c])),_:1},8,["onClick"]),(0,l.Wm)(S,{type:"success",onClick:v.headAddButton},{default:(0,l.w5)((()=>[u])),_:1},8,["onClick"])]),(0,l._)("section",p,[(0,l.Wm)(F,{size:"default",data:M.tableData,border:"",style:{width:"100%"},"empty-text":"没有数据",onCellClick:v.tableCellClick},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{"header-align":"center",align:"center",label:"#",width:"60"},{default:(0,l.w5)((e=>[(0,l.Uk)((0,o.zw)(e.$index+1),1)])),_:1}),(0,l.Wm)(x,{"header-align":"center",align:"center",label:"分类",width:"60"},{default:(0,l.w5)((e=>[(0,l.Uk)((0,o.zw)(v.newsType(e.row)),1)])),_:1}),(0,l.Wm)(x,{"header-align":"center",align:"left",prop:"title",label:"标题",width:"300"},{default:(0,l.w5)((e=>[(0,l._)("p",{class:"single-line-show",title:e.row.title},(0,o.zw)(e.row.title),9,m)])),_:1}),(0,l.Wm)(x,{"header-align":"center",align:"left",prop:"content",label:"内容"},{default:(0,l.w5)((e=>[(0,l._)("p",w,(0,o.zw)(e.row.content),1)])),_:1}),(0,l.Wm)(x,{"header-align":"center",align:"center",prop:"edit_time",label:"上次修改时间",width:"170"},{default:(0,l.w5)((e=>[(0,l.Uk)((0,o.zw)(v.formatDate(e.row.edit_time)),1)])),_:1}),(0,l.Wm)(x,{"header-align":"center",align:"center",prop:"create_time",label:"新闻创建时间",width:"170"},{default:(0,l.w5)((e=>[(0,l.Uk)((0,o.zw)(v.formatDate(e.row.create_time)),1)])),_:1}),(0,l.Wm)(x,{"header-align":"center",align:"center",label:"操作",width:"200"},{default:(0,l.w5)((e=>[(0,l.Wm)(S,{type:"primary",onClick:t=>v.rowEditButton(e)},{default:(0,l.w5)((()=>[g])),_:2},1032,["onClick"]),(0,l.Wm)(Y,{"confirm-button-text":"是","cancel-button-text":"否","icon-color":"red",title:"确定要删除【"+e.row.title+"】吗?",onConfirm:t=>v.rowDeleteButton(e.row)},{reference:(0,l.w5)((()=>[(0,l.Wm)(S,{type:"warning"},{default:(0,l.w5)((()=>[b])),_:1})])),_:2},1032,["title","onConfirm"])])),_:1})])),_:1},8,["data","onCellClick"])]),(0,l.Wm)(A,{modelValue:M.editDialogVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>M.editDialogVisible=e),"close-on-click-modal":!1,"destroy-on-close":!0,"custom-class":"edit-dialog"},{footer:(0,l.w5)((()=>[(0,l._)("span",_,[(0,l.Wm)(S,{onClick:t[4]||(t[4]=e=>M.editDialogVisible=!1)},{default:(0,l.w5)((()=>[k])),_:1}),"add"===M.dialogMode?((0,l.wg)(),(0,l.j4)(S,{key:0,type:"primary",onClick:v.addDialogButton},{default:(0,l.w5)((()=>[V])),_:1},8,["onClick"])):((0,l.wg)(),(0,l.j4)(S,{key:1,type:"primary",onClick:v.editDialogButton},{default:(0,l.w5)((()=>[z])),_:1},8,["onClick"]))])])),default:(0,l.w5)((()=>[(0,l.Wm)(N,{"label-width":"80px",model:M.tableRowData},{default:(0,l.w5)((()=>[(0,l.Wm)(G,{label:"新闻分类:"},{default:(0,l.w5)((()=>[(0,l.Wm)(H,{modelValue:M.tableRowData.type,"onUpdate:modelValue":t[2]||(t[2]=e=>M.tableRowData.type=e),placeholder:"请选择新闻分类"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(M.newsTypeGroup,(e=>((0,l.wg)(),(0,l.j4)($,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(G,{label:"新闻标题:"},{default:(0,l.w5)((()=>[(0,l.Wm)(B,{modelValue:M.tableRowData.title,"onUpdate:modelValue":t[3]||(t[3]=e=>M.tableRowData.title=e),placeholder:"请输入新闻标题"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(G,{label:"缩略图:",class:"upload-image"},{default:(0,l.w5)((()=>[(0,l.Wm)(L,{class:"avatar-uploader",action:v.uploadImageUrl,headers:v.uploadImageHeaders,name:"news-info","show-file-list":!1,"list-type":"picture","on-success":v.imageUploadSuccess,"before-upload":v.imageUploadBefore},{default:(0,l.w5)((()=>[M.tableRowData.thumbnail?((0,l.wg)(),(0,l.iD)("img",{key:0,src:M.tableRowData.thumbnail,class:"image"},null,8,h)):((0,l.wg)(),(0,l.j4)(I,{key:1,class:"avatar-uploader-icon"},{default:(0,l.w5)((()=>[(0,l.Wm)(j)])),_:1}))])),_:1},8,["action","headers","on-success","before-upload"]),D])),_:1}),(0,l.Wm)(G,{label:"新闻内容:"},{default:(0,l.w5)((()=>[f,y])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),(0,l.Wm)(A,{modelValue:M.detailDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>M.detailDialogVisible=e),"destroy-on-close":!0,"custom-class":"show-dialog"},{footer:(0,l.w5)((()=>[(0,l._)("span",T,[(0,l.Wm)(S,{type:"primary",onClick:t[6]||(t[6]=e=>M.detailDialogVisible=!1)},{default:(0,l.w5)((()=>[R])),_:1})])])),default:(0,l.w5)((()=>[(0,l._)("h3",C,(0,o.zw)(M.tableRowDetailData.title),1),(0,l._)("section",W,[(0,l._)("article",{class:"detail-content",innerHTML:M.tableRowDetailData.content},null,8,U)])])),_:1},8,["modelValue"])])}var v=a(9702),B=a.n(v),$=a(65),H=a(5574),S=a(5380),x=a(9713),Y={name:"news-manage",components:{},props:{},data(){return{headForm:{keyword:"",type:0},tableData:[],tableRowData:{},dialogMode:"",editDialogVisible:!1,tableRowDetailData:{},detailDialogVisible:!1,newsTypeGroup:[],editor:null}},watch:{editDialogVisible:{handler(e,t){console.log("监视user对象变化",e,e===t),e&&this.$nextTick((()=>{this.editor=new window.Quill(".editor-content",{debug:"warn",theme:"snow",modules:{toolbar:{container:".editor-toolbar",handlers:{upload:()=>{console.log(99999)}}}},placeholder:"请输入新闻内容"})}))}}},computed:{...(0,$.Se)(["token"]),headNewsTypeGroup(){return[].concat([{label:"全部",value:0}],this.newsTypeGroup)},uploadImageHeaders:function(){return{Authorization:this.token,["X-Void-Risk"]:1}},uploadImageUrl:function(){let e=String(Math.random()).substring(2),t=(new Date).getTime(),a=B()(`/api/upload/image~${e}${t}`);return`//127.0.0.1:12580/api/upload/image?nonce=${e}&ts=${t}&s=${a}`}},beforeCreate(){},created(){this.getNewsTypeList(),this.getTableData()},beforeMount(){},mounted(){},beforeUpdate(){},updated(){},beforeUnmount(){},unmounted(){},methods:{getNewsTypeList(){const e=this;(0,x.QO)().then((t=>{const{code:a,data:l,message:o}=t.data;200===a?e.newsTypeGroup=l:H.z8.error(o)}))},getTableData(){const e=this;(0,x.zi)(e.headForm).then((t=>{const{code:a,data:l,message:o}=t.data;200===a?e.tableData=l:H.z8.error(o)}))},formatDate(e){let t=(0,S.formatTargetDate)(e);return`${t.YY}-${t.MM}-${t.DD} ${t.HH}:${t.mm}:${t.ss}`},newsType(e){return this.newsTypeGroup.filter((t=>e.type===t.value))[0].label},headSearchButton(){this.getTableData()},headResetButton(){this.headForm={keyword:"",type:0}},headAddButton(){this.tableRowData={title:"",content:"",thumbnail:"",type:""},this.dialogMode="add",this.editDialogVisible=!0},tableCellClick(e,t){"title"!==t.property&&"content"!==t.property||(this.tableRowDetailData={title:e.title,content:e.content},this.detailDialogVisible=!0)},rowEditButton(e){this.tableRowData={index:e.$index,...e.row},this.dialogMode="edit",this.editDialogVisible=!0},rowDeleteButton(e){const t=this;(0,x.f_)({op_type:0,id:e.id}).then((e=>{const{code:a,message:l}=e.data;200===a?(H.z8.success(l),t.getTableData()):H.z8.error(l)}))},addDialogButton(){const e=this,{title:t,content:a,type:l}=e.tableRowData;l?t?a?(0,x.yQ)(e.tableRowData).then((t=>{const{code:a,message:l}=t.data;200===a?(H.z8.success(l),e.getTableData(),e.editDialogVisible=!1):H.z8.error(l)})):H.z8.error("新闻内容不能为空"):H.z8.error("新闻标题不能为空"):H.z8.error("请选择新闻分类")},editDialogButton(){const e=this,{index:t,id:a,title:l,content:o,type:i}=e.tableRowData;let n={op_type:1,id:a};i?(i!==e.tableData[t].type&&(n.type=i),l?(l!==e.tableData[t].title&&(n.title=l),o?(o!==e.tableData[t].content&&(n.content=o),Object.keys(n).length>2?(0,x.f_)(n).then((t=>{const{code:a,message:l}=t.data;200===a?(H.z8.success(l),e.getTableData(),e.editDialogVisible=!1):H.z8.error(l)})):H.z8.warning("什么都没有更改！")):H.z8.error("新闻内容不能为空")):H.z8.error("新闻标题不能为空")):H.z8.error("请选择新闻分类")},imageUploadBefore(e){let t=!0;return/image\//.test(e.type)||(t=!1,H.z8.error("请上传图片类型的文件！")),t},imageUploadSuccess(e){const{code:t,data:a,message:l}=e;10004===t?(H.z8.error(l),this.$router.push("/")):200===t?(this.tableRowData.thumbnail=a.url,H.z8.success(l)):H.z8.error(l)}}},F=a(89);const G=(0,F.Z)(Y,[["render",M],["__scopeId","data-v-51a328ba"]]);var j=G}}]);
//# sourceMappingURL=927.33ab9590.js.map